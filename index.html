<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Grambahar Scraper</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    input {
      padding: 8px;
      width: 300px;
      margin-bottom: 15px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
      cursor: pointer;
    }

    tr:nth-child(even) {
      background-color: #fafafa;
    }
  </style>
</head>

<body>

<h1>Grambahar Scraper (CI + CD)</h1>

<p>Latest scraped data:</p>
<ul>
  <li><a href="product_variants.csv" download>Download Product Variants CSV</a></li>
  <li><a href="contact_info.csv" download>Download Contact Info CSV</a></li>
  <li><a href="site_logo.csv" download>Download Site Logo CSV</a></li>
</ul>

<h2>Product Variants</h2>

<input
  type="text"
  id="searchInput"
  placeholder="Search products..."
  onkeyup="filterTable()"
/>

<table id="csvTable"></table>

<script>
let tableData = [];
let sortDirection = true;

fetch("product_variants.csv")
  .then(res => res.text())
  .then(text => {
    tableData = text.trim().split("\n").map(row => row.split(","));
    renderTable(tableData);
  });

function renderTable(data) {
  const table = document.getElementById("csvTable");
  table.innerHTML = "";

  data.forEach((row, rowIndex) => {
    const tr = document.createElement("tr");

    row.forEach((cell, colIndex) => {
      const el = document.createElement(rowIndex === 0 ? "th" : "td");
      el.textContent = cell;

      if (rowIndex === 0) {
        el.onclick = () => sortTable(colIndex);
      }

      tr.appendChild(el);
    });

    table.appendChild(tr);
  });
}

function filterTable() {
  const query = document.getElementById("searchInput").value.toLowerCase();
  const filtered = [tableData[0]];

  tableData.slice(1).forEach(row => {
    if (row.join(" ").toLowerCase().includes(query)) {
      filtered.push(row);
    }
  });

  renderTable(filtered);
}

function sortTable(colIndex) {
  const header = tableData[0];
  const rows = tableData.slice(1);

  rows.sort((a, b) => {
    const x = a[colIndex];
    const y = b[colIndex];

    return sortDirection
      ? x.localeCompare(y, undefined, { numeric: true })
      : y.localeCompare(x, undefined, { numeric: true });
  });

  sortDirection = !sortDirection;
  renderTable([header, ...rows]);
}
</script>

<p style="margin-top:20px;">
  Scraper runs automatically via GitHub Actions on Ubuntu.
</p>

</body>
</html>
