<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Grambahar Scraper (CI + CD)</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
    }

    button {
      padding: 12px 22px;
      font-size: 16px;
      margin-right: 12px;
      cursor: pointer;
      background: #0d6efd;
      color: #fff;
      border: none;
      border-radius: 6px;
    }

    button:hover {
      background: #084298;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 30px;
      display: none;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }

    th {
      background: #f3f3f3;
    }

    a {
      color: #0d6efd;
      text-decoration: none;
      font-weight: 500;
    }
  </style>
</head>

<body>

<h1>Grambahar Scraper (CI + CD)</h1>
<p>Scraped product data with live links.</p>

<button onclick="showOutput()">Show Extracted Output</button>
<button onclick="openGrambahar()">Open Grambahar Website</button>

<table id="dataTable">
  <thead>
    <tr>
      <th>Product Name</th>
      <th>Variant</th>
      <th>Weight (gm)</th>
      <th>Weight (kg)</th>
      <th>Selling Price (₹)</th>
      <th>Price / kg (₹)</th>
      <th>Product Page</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
function openGrambahar() {
  window.open("https://grambahar.com", "_blank");
}

function showOutput() {
  fetch("product_variants.csv")
    .then(res => res.text())
    .then(csv => {
      const lines = csv.trim().split("\n").slice(1);
      const body = document.getElementById("tableBody");
      const table = document.getElementById("dataTable");

      body.innerHTML = "";
      table.style.display = "table";

      lines.forEach(line => {
        const parts = line
          .match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)
          .map(v => v.replace(/^"|"$/g, ""));

        const productName = parts[0];
        const variant = parts[1];
        const weightGm = parts[2];
        const weightKg = parts[3];
        const sellingPrice = parts[4];
        const pricePerKg = parts[6];

        const productUrl =
          parts[parts.length - 1] && parts[parts.length - 1].startsWith("http")
            ? parts[parts.length - 1]
            : "https://grambahar.com/products";

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><a href="${productUrl}" target="_blank">${productName}</a></td>
          <td>${variant}</td>
          <td>${weightGm}</td>
          <td>${weightKg}</td>
          <td>${sellingPrice}</td>
          <td>${pricePerKg}</td>
          <td><a href="${productUrl}" target="_blank">View Product</a></td>
        `;
        body.appendChild(tr);
      });
    })
    .catch(err => {
      console.error(err);
      alert("Failed to load CSV file");
    });
}
</script>



</body>
</html>
